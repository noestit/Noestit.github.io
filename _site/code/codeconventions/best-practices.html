<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.23.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Best practice - Noest docs</title>
<meta name="description" content="This is the document site of Noest.">



<meta property="og:type" content="website">
<meta property="og:locale" content="en">
<meta property="og:site_name" content="Noest docs">
<meta property="og:title" content="Best practice">
<meta property="og:url" content="http://localhost:4000/code/codeconventions/best-practices">


  <meta property="og:description" content="This is the document site of Noest.">












<link rel="canonical" href="http://localhost:4000/code/codeconventions/best-practices">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Noest",
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Noest docs Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/Block_Logo_Green.png" alt="Noest docs"></a>
        
        <a class="site-title" href="/">
          Noest docs
          <span class="site-subtitle">Code conventions, best practices and configuration files.</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/">Home</a>
            </li><li class="masthead__menu-item">
              <a href="/tooling/index">Tooling</a>
            </li><li class="masthead__menu-item">
              <a href="/documentationtechniques/index">Documentation</a>
            </li><li class="masthead__menu-item">
              <a href="/code/index">Code</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">Code Conventions</span>
        

        
        <ul>
          
            <li><a href="/code/codeconventions/conventions">Main</a></li>
          
            <li><a href="/code/codeconventions/best-practices" class="active">Best practices</a></li>
          
            <li><a href="/code/codeconventions/entity-framework-linq">EF & Linq</a></li>
          
            <li><a href="/code/codeconventions/logging">Logging</a></li>
          
            <li><a href="/code/codeconventions/pattern-matching">Pattern matching</a></li>
          
            <li><a href="/code/codeconventions/tdd-unit-testing">TDD unit testing</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Code Guidelines</span>
        

        
        <ul>
          
            <li><a href="/code/codeguidelines/coding-style">Coding Style</a></li>
          
            <li><a href="/code/codeguidelines/folder-structure">Folder structure</a></li>
          
            <li><a href="/code/codeguidelines/globalization">Globalization</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>

    
  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Best practice">
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Best practice
</h1>
          


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu"><li><a href="#startup-class-and-services">Startup class and Services</a><ul><li><a href="#servicecollection-extension-pattern">ServiceCollection Extension Pattern</a></li><li><a href="#middleware">Middleware</a><ul><li><a href="#creating-middleware">Creating middleware</a></li></ul></li></ul></li><li><a href="#validation">Validation</a><ul><li><a href="#use-data-annotations-for-server-side-validation">Use data annotations for server-side validation</a></li><li><a href="#modelstate">Modelstate</a></li></ul></li></ul>

            </nav>
          </aside>
        
        <h2 id="startup-class-and-services">Startup class and Services</h2>

<h3 id="servicecollection-extension-pattern">ServiceCollection Extension Pattern</h3>

<p>.NET Core has a built-in DI (IoC) container. In the <code class="language-plaintext highlighter-rouge">ConfigureServices()</code> method in the <code class="language-plaintext highlighter-rouge">startup.cs</code> file in the host <code class="language-plaintext highlighter-rouge">ASP.NET Core</code> project, services are added to the DI container.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">void</span> <span class="nf">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">services</span><span class="p">.</span><span class="nf">AddControllers</span><span class="p">();</span>

    <span class="p">....</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddTransient</span><span class="p">&lt;</span><span class="n">IUserService</span><span class="p">,</span> <span class="n">UserService</span><span class="p">&gt;();</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddScoped</span><span class="p">&lt;</span><span class="n">INoestService</span><span class="p">,</span> <span class="n">NoestService</span><span class="p">&gt;();</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddScoped</span><span class="p">&lt;</span><span class="n">IProductRepository</span><span class="p">,</span> <span class="n">ProductRepository</span><span class="p">&gt;();</span>
    <span class="n">services</span><span class="p">.</span><span class="n">TryAddSingleton</span><span class="p">&lt;</span><span class="n">GraphQLQuery</span><span class="p">&gt;();</span>
    <span class="p">...</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">ConfigureServices</code> should be clean and readable. We can extract chunks of code from the startup class to extension methods.</p>

<p><strong>Example</strong></p>

<p>The <code class="language-plaintext highlighter-rouge">Data</code> layer in your solution holds repositories, and we need to add these to the DI container. We can create our own extension method that registers all the repositories. This method accepts parameter <code class="language-plaintext highlighter-rouge">this IServiceCollection</code> so we can bind our variables and return the <code class="language-plaintext highlighter-rouge">IServiceCollection</code> instance with the services registered.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">Microsoft.Extensions.DependencyInjection</span><span class="p">;</span>

<span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">ServicesConfiguration</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">IServiceCollection</span> <span class="nf">AddRepositories</span><span class="p">(</span><span class="k">this</span> <span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">services</span><span class="p">.</span><span class="n">AddTransient</span><span class="p">&lt;</span><span class="n">IUserRepository</span><span class="p">,</span> <span class="n">UserRepository</span><span class="p">&gt;();</span>
        <span class="n">services</span><span class="p">.</span><span class="n">AddTransient</span><span class="p">&lt;</span><span class="n">IProductRepository</span><span class="p">,</span> <span class="n">ProductRepository</span><span class="p">&gt;();</span>
        <span class="p">...</span>
        <span class="k">return</span> <span class="n">services</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>


</code></pre></div></div>

<p>After referencing the <code class="language-plaintext highlighter-rouge">Data</code> project to your <code class="language-plaintext highlighter-rouge">ASP.NET Core</code> host project, you can add the services to the container in the <code class="language-plaintext highlighter-rouge">ConfigureServices()</code> method in the <code class="language-plaintext highlighter-rouge">startup.cs</code> file in a nice and clean way:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">void</span> <span class="nf">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">services</span><span class="p">.</span><span class="nf">AddControllers</span><span class="p">();</span>
    <span class="n">services</span><span class="p">.</span><span class="nf">AddRepositories</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">IServiceCollection</code> is not part of the .NET Standard. Install the latest <code class="language-plaintext highlighter-rouge">Microsoft.Extensions.DependencyInjection.Abstractions</code> package for this use.</p>
</blockquote>

<h3 id="middleware">Middleware</h3>

<p>In <code class="language-plaintext highlighter-rouge">ASP.NET</code> we had modules, handlers a <code class="language-plaintext highlighter-rouge">web.config</code> file. In <code class="language-plaintext highlighter-rouge">ASP.NET Core</code> there is middleware, which is also set up in the startup class.</p>

<p>Middleware controls how the application responds <code class="language-plaintext highlighter-rouge">HTTP</code> requests, and we define these pieces in the <code class="language-plaintext highlighter-rouge">Configure()</code> method. We do this by using the <code class="language-plaintext highlighter-rouge">IApplicationBuilder</code> instance, and there are 4 methods to interact with a request.</p>

<p><strong>Use</strong> adds a middleware to the pipeline and it can pass the request to the next delegate, or end it.
<strong>Map</strong> is used to connect a request path with another middleware.
<strong>MapWhen</strong> is almost the same as <strong>Map</strong>, but we can specify the detailed condition by using a <code class="language-plaintext highlighter-rouge">HttpContext</code> object.
<strong>Run</strong> adds a terminal middleware delegate to the applicationâ€™s request pipeline.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">void</span> <span class="nf">Configure</span><span class="p">(</span><span class="n">IApplicationBuilder</span> <span class="n">app</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">app</span><span class="p">.</span><span class="nf">Map</span><span class="p">(</span><span class="s">"/route"</span><span class="p">,</span> <span class="n">HandleRouteMethod</span><span class="p">);</span>

    <span class="n">app</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="k">async</span> <span class="k">delegate</span> <span class="p">(</span><span class="n">HttpContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">Func</span><span class="p">&lt;</span><span class="n">Task</span><span class="p">&gt;</span> <span class="n">next</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">await</span> <span class="n">next</span><span class="p">.</span><span class="nf">Invoke</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">HandleRouteMethod</span><span class="p">(</span><span class="n">IApplicationBuilder</span> <span class="n">app</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="k">async</span> <span class="n">context</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="nf">WriteAsync</span><span class="p">(</span><span class="s">"Hello from the other route"</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="creating-middleware">Creating middleware</h4>

<p>Basically, you move the code in the <code class="language-plaintext highlighter-rouge">Use</code> method to a separate class. To be able to use this we will have to make a extension method.</p>

<p>Example implementation of global error handling middleware:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">CustomExceptionMiddleware</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">RequestDelegate</span> <span class="n">_next</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">ILogger</span><span class="p">&lt;</span><span class="n">SampleMiddleware</span><span class="p">&gt;</span> <span class="n">_logger</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">SampleMiddleware</span><span class="p">(</span><span class="n">RequestDelegate</span> <span class="n">next</span><span class="p">,</span> <span class="n">ILogger</span><span class="p">&lt;</span><span class="n">SampleMiddleware</span><span class="p">&gt;</span> <span class="n">logger</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_next</span> <span class="p">=</span> <span class="n">next</span><span class="p">;</span>
        <span class="n">_logger</span> <span class="p">=</span> <span class="n">logger</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Invoke</span><span class="p">(</span><span class="n">HttpContext</span> <span class="n">httpContext</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">try</span>
        <span class="p">{</span>
            <span class="k">await</span> <span class="nf">_next</span><span class="p">(</span><span class="n">httpContext</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_logger</span><span class="p">.</span><span class="nf">LogError</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">"Unhandled exception ..."</span><span class="p">);</span>
            <span class="k">await</span> <span class="nf">HandleExceptionAsync</span><span class="p">(</span><span class="n">httpContext</span><span class="p">,</span> <span class="n">ex</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Extension method:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">CustomExceptionMiddlewareExtension</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">IApplicationBuilder</span> <span class="nf">UseCustomExceptionMiddleware</span><span class="p">(</span><span class="k">this</span> <span class="n">IApplicationBuilder</span> <span class="n">builder</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">builder</span><span class="p">.</span><span class="n">UseMiddleware</span><span class="p">&lt;</span><span class="n">CustomExceptionMiddleware</span><span class="p">&gt;();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Just like the services in the <code class="language-plaintext highlighter-rouge">Service Collection Extension Pattern</code> section above, we can now add this middleware in 1 line to our startup class, in the <code class="language-plaintext highlighter-rouge">Configure()</code> method.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">void</span> <span class="nf">Configure</span><span class="p">(</span><span class="n">IApplicationBuilder</span> <span class="n">app</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">...</span>
    <span class="n">app</span><span class="p">.</span><span class="nf">UseCustomExceptionMiddleware</span><span class="p">();</span>

    <span class="n">app</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="k">async</span> <span class="k">delegate</span> <span class="p">(</span><span class="n">HttpContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">Func</span><span class="p">&lt;</span><span class="n">Task</span><span class="p">&gt;</span> <span class="n">next</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">await</span> <span class="n">next</span><span class="p">.</span><span class="nf">Invoke</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="validation">Validation</h2>

<h3 id="use-data-annotations-for-server-side-validation">Use data annotations for server-side validation</h3>

<p>Use the <code class="language-plaintext highlighter-rouge">System.ComponentModel.DataAnnotations</code> namespace to access annotations for server side validation.</p>

<p><strong>Note:</strong> server-side validation is mandatory.</p>

<p>In our example we demonstrate server side vaidation through <code class="language-plaintext highlighter-rouge">DataAnnotations</code> when creating a new user.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">CreateUserViewModel</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">Required</span><span class="p">(</span><span class="n">ErrorMessage</span><span class="p">=</span><span class="s">"Username is mandatory"</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">MaxLength</span><span class="p">(</span><span class="m">100</span><span class="p">)]</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="modelstate">Modelstate</h3>

<p>In the controller, we can check if the <code class="language-plaintext highlighter-rouge">modelstate</code> is valid. <code class="language-plaintext highlighter-rouge">ModelState.IsValid</code> determines wether the submitted values statisfy all <code class="language-plaintext highlighter-rouge">DataAnnotation</code> validation attributes applied to the model properties.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="n">HttpPost</span><span class="p">]</span>
<span class="k">public</span> <span class="n">ActionResult</span> <span class="nf">CreateUser</span><span class="p">(</span><span class="n">CreateUserViewModel</span> <span class="n">createUserForm</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(!</span><span class="n">ModelState</span><span class="p">.</span><span class="n">IsValid</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//Code to handle invalid form</span>
    <span class="p">}</span>

    <span class="c1">//Code to create user</span>
<span class="p">}</span>
</code></pre></div></div>

        
      </section>

      <footer class="page__meta">
        
        


        


      </footer>

      

      
    </div>

    
  </article>

  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
      
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 Noest. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>










  </body>
</html>
